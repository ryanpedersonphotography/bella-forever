---
import NavButton from "./NavButton.svelte";
import Handwriting from "./Handwriting.svelte";
const THEMES = {
  summer: {
    bg: "/sd.png",
    cloud: "/cloudl3.png",
    watertower: "/bobber3b.png",
    treeline: "/treeline6.png",
    store: "/bella-store-transparent.png",
    storeBase: "/store-base.png",
    bella: "/bella-pose3.png",
    grass: "/fg5.png"
  }
};
const theme = THEMES.summer;

// Data for Navigation Buttons
const navButtons = [
  { label: 'Home',    href: '/',         scene: 'home',    image: '/button1.png', variant: 'dark' },
  { label: 'About',   href: '/about',    scene: 'about',   image: '/button2.png', variant: 'dark' },
  { label: 'Shop',    href: '/shop',     scene: 'shop',    image: '/button3.png', variant: 'light' },
  { label: 'Gallery', href: '/gallery',  scene: 'gallery', image: '/button4.png', variant: 'dark' },
  { label: 'Contact', href: '/contact',  scene: 'contact', image: '/button5.png', variant: 'dark' },
  { label: 'Blog',    href: '/blog',     scene: 'blog',    image: '/blog3.png', variant: 'light' },
];

// Data for store-base waves
const waves = [
  { top: 580, height: 5, depth: 0.17 }, { top: 590, height: 10, depth: 0.18 },
  { top: 600, height: 15, depth: 0.19 }, { top: 610, height: 25, depth: 0.20 },
  { top: 625, height: 35, depth: 0.21 }, { top: 640, height: 45, depth: 0.22 },
  { top: 660, height: 55, depth: 0.23 }, { top: 685, height: 65, depth: 0.24 },
  { top: 715, height: 75, depth: 0.25 },
];

const SCENE_COUNT = 6;
import { aboutSections } from "../scripts/stage-config";
---

<div class="viewport">
  <!-- STATIONARY BACKGROUND -->
  <div class="background">
    <img class="bg-image" src={theme.bg} alt="Watercolor Sky Background" />
  </div>

  <div id="camera">
    <!-- MOVING WORLD (scenes only) -->
    <div id="world" class="world" style={`height:${SCENE_COUNT * 100}vh`}>
      <!-- ============================================= -->
      <!-- SCENE 1: HOME                                 -->
      <!-- ============================================= -->
      <section id="home" class="scene">
        <div class="hero-stage__inner heroStage">
          <!-- Background image removed from here -->
          
          <div class="hero-layer" style="left: 800px; top: 150px; width: 400px;" data-stage-anim>
            <Handwriting 
              client:visible
              text="welcome to my site, xoxo bella"
              fontSize={54}
              color="#3c2e2a"
              duration={2000}
              delay={500}
            />
          </div>

          <img class="cloud hero-layer" src={theme.cloud} alt="Cloud" style="left: 1400px; top: 200px; width: 300px; z-index: 0;" data-stage-anim />
          <img class="waterTower hero-layer" src={theme.watertower} alt="Watertower" style="left: 1600px; top: 400px; width: 260px; z-index: 0;" data-stage-anim />
          <div class="treesFar hero-layer" style={`left: 960px; top: 500px; width: 4000px; height: 150px; background-image: url('${theme.treeline}'); background-repeat: repeat-x; background-position: bottom center; background-size: auto 100%;`} data-stage-anim></div>
          {waves.map((wave, i) => (
            <div class="store-base-wave hero-layer" style={`left: 960px; top: ${wave.top}px; width: 4000px; height: ${wave.height}px; background-image: url('${theme.storeBase}'); background-repeat: repeat-x; background-position: top center; background-size: auto 100%; opacity: ${0.2 + (i * 0.1)}; filter: drop-shadow(0px 2px 5px rgba(0,0,0,0.2));`} data-stage-anim></div>
          ))}
          <img class="shop hero-layer" src={theme.store} alt="Bella's Storefront" style="left: 960px; top: 585px; width: 600px; filter: drop-shadow(0px 10px 15px rgba(0,0,0,0.5));" data-stage-anim />
          <div class="grass hero-layer" style={`left: 960px; top: 870px; width: 8000px; height: 360px; background-image: url('${theme.grass}'); background-repeat: no-repeat; background-position: bottom center; background-size: auto 100%;`} data-stage-anim></div>
          
          <!-- DEPTH OVERLAYS -->
          <div class="atmoHaze" aria-hidden="true"></div>
          <div class="storeShadow" aria-hidden="true"></div>
          <div class="foregroundPop" aria-hidden="true"></div>
        </div>
      </section>

      <!-- ============================================= -->
      <!-- SCENE 2: ABOUT                                -->
      <!-- ============================================= -->
      <section id="about" class="scene">
          <!-- Horizontal sections -->
          <div id="story" class="aboutSection" data-stage-anim>
            <div class="about-content" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: #3c2e2a; z-index: 10;">
                <h1 style="font-family: 'Palatino Linotype', Palatino, serif; font-size: 64px;">Our Story</h1>
                <div style="max-width: 600px; margin-top: 1rem;">
                  <Handwriting 
                    client:visible 
                    text="A tiny fairytale boutique where little-daydream dresses come to life. Step into our watercolor world." 
                    fontSize={34} 
                    color="#3c2e2a" 
                    duration={1500}
                  />
                </div>
            </div>
          </div>
          <div id="location" class="aboutSection" style="background-color: #fdf6e3;" data-stage-anim>
            <div class="about-content" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: #3c2e2a; z-index: 10;">
                <h1 style="font-family: 'Palatino Linotype', Palatino, serif; font-size: 64px;">Location</h1>
            </div>
          </div>
          <div id="team" class="aboutSection" style="background-color: #e3f6f6;" data-stage-anim>
            <div class="about-content" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: #3c2e2a; z-index: 10;">
                <h1 style="font-family: 'Palatino Linotype', Palatino, serif; font-size: 64px;">Team</h1>
            </div>
          </div>
          <div id="faq" class="aboutSection" style="background-color: #f6e3fd;" data-stage-anim>
            <div class="about-content" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: #3c2e2a; z-index: 10;">
                <h1 style="font-family: 'Palatino Linotype', Palatino, serif; font-size: 64px;">FAQ</h1>
            </div>
          </div>
      </section>

      <!-- ============================================= -->
      <!-- SCENE 3: SHOP (Placeholder)                   -->
      <!-- ============================================= -->
      <section id="shop" class="scene">
        <div style="display: grid; place-items: center; height: 100%; color: #3c2e2a;" data-stage-anim>
          <h1>Shop (Placeholder)</h1>
        </div>
      </section>

      <!-- ============================================= -->
      <!-- SCENE 4: GALLERY (Placeholder)                -->
      <!-- ============================================= -->
      <section id="gallery" class="scene">
         <div style="display: grid; place-items: center; height: 100%; color: #3c2e2a;" data-stage-anim>
          <h1>Gallery (Placeholder)</h1>
        </div>
      </section>

      <!-- ============================================= -->
      <!-- SCENE 5: CONTACT (Placeholder)                -->
      <!-- ============================================= -->
      <section id="contact" class="scene">
         <div style="display: grid; place-items: center; height: 100%; color: #3c2e2a;" data-stage-anim>
          <h1>Contact (Placeholder)</h1>
        </div>
      </section>

      <!-- ============================================= -->
      <!-- SCENE 6: BLOG (Placeholder)                   -->
      <!-- ============================================= -->
      <section id="blog" class="scene">
         <div style="display: grid; place-items: center; height: 100%; color: #3c2e2a;" data-stage-anim>
          <h1>Blog (Placeholder)</h1>
        </div>
      </section>
    </div>
  </div>

  <!-- PERSISTENT OVERLAY (does NOT move) -->
  <div class="overlay" style="--nav-horizontal-margin: 2rem;">
    <a class="signLink" href="/" aria-label="Home" title="Home">
      <img class="hanging-sign" src="/bellassignroses.png" alt="Bella's Dresser sign" />
    </a>
    
    <nav class="navCluster" aria-label="Primary">
      {navButtons.filter(b => b.label !== 'Home').map(button => {
        const isActive = Astro.url.pathname === button.href || (button.href !== '/' && Astro.url.pathname.startsWith(button.href));
        return (
          <a class={`navTag ${isActive ? 'navTag--active' : ''}`} href={button.href} aria-current={isActive ? 'page' : undefined}>
            <img class="navTag__img" src={isActive ? "/button1c.png" : "/button1b.png"} alt="" aria-hidden="true" />
            <span class="navTag__label">{button.label}</span>
          </a>
        );
      })}
    </nav>

    <img class="bella" src={theme.bella} alt="Bella" />
    
    <!-- Side Navigation for 'About' sections -->
    <aside class="sideNav" aria-label="About sections">
      {aboutSections.map(section => (
        <a href={`/about#${section}`}>{section.charAt(0).toUpperCase() + section.slice(1)}</a>
      ))}
    </aside>
  </div>

  <!-- OPTIONAL FOREGROUND OVERLAY (does NOT move) -->
  <div class="foreground">
    <!-- <img src="/img/foreground-grass.png" alt="" /> -->
  </div>
<style>
/* General Scene Styles */
.viewport { 
  width: 100vw; 
  height: 100vh; 
  overflow: hidden; 
  position: fixed; 
  top: 0;
  left: 0;
}
.background {
  position: absolute;
  inset: 0;
  z-index: 0; /* Behind the world */
}

.bg-image {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

#camera {
  position: absolute;
  inset: 0;
  transform-origin: center center;
  will-change: transform;
}

.world { 
  position: absolute;
  inset: 0;
  width: 100vw; 
  will-change: transform;
  z-index: 1;
}
.scene { 
  width: 100vw; 
  height: 100vh; 
  position: relative;
  overflow: hidden;
  background-color: transparent; /* Changed to transparent */
}
.hero-stage__inner {
  position: absolute;
  top: 0;
  left: 0;
  width: 1920px;
  height: 1080px;
  transform-origin: top left;
  /* GSAP will handle scaling in the router now if needed, but for now we assume fixed size */
}
.hero-layer {
  position: absolute;
  will-change: transform;
  user-select: none;
  pointer-events: none;
  transform: translate(-50%, -50%); /* Center anchor default */
}

/* stays put while world pans */
.overlay {
  position: fixed;
  inset: 0;
  z-index: 10;
  pointer-events: none; /* allow world clicks unless you need them */
}

/* --- SIGN: top-left + clickable --- */
.signLink{
  position: absolute;
  top: -70px;       /* keep chain attachment above viewport */
  left: 110px;      /* moves sign to top-left like your mock */
  z-index: 200;
  pointer-events: auto; /* clickable even though overlay is pointer-events:none */
  display: block;
}

.hanging-sign{
  position: relative;
  width: 680px;              /* tune: 640–720 depending on taste */
  height: auto;
  pointer-events: auto;       /* allow click (or you can leave image non-clickable and rely on link) */
  filter: drop-shadow(0 10px 14px rgba(0,0,0,0.18))
          drop-shadow(0 2px 4px rgba(0,0,0,0.12));
  transform-origin: 20% 0%;   /* sway feels more “hung” */
}

/* optional: tiny sway */
.hanging-sign{
  animation: signSway 8s ease-in-out infinite;
}
 @keyframes signSway{
  0%,100%{ transform: rotate(-0.25deg); }
  50%    { transform: rotate(0.25deg); }
}

#about.scene{
  display:flex;        /* horizontal sections */
  width: 400vw;        /* 4 sections */
  height:100vh;
}

#about .aboutSection{
  width:100vw;
  height:100vh;
  flex: 0 0 100vw;
}

.foreground {
  position: absolute;
  inset: auto 0 0 0;
  height: 34vh;        /* tune */
  z-index: 20;
  pointer-events: none;
}

.foreground img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.sideNav{ position:absolute; left:28px; top:170px; z-index:120; display:flex; flex-direction:column; gap:14px;
          opacity:0; transform:translateY(-4px); transition:opacity .2s ease, transform .2s ease; pointer-events: none; }
.sideNav.is-active{ opacity:1; transform:translateY(0); pointer-events: auto; }
.sideNav a{ text-decoration:none; font-family:"Nunito",system-ui,sans-serif; font-weight:800; color:#3c2e2a;
           background:rgba(255,255,255,.55); border:1px solid rgba(60,46,42,.18); border-radius:12px;
           padding:10px 14px; backdrop-filter:blur(6px); }

/* --- Button Styles --- */
:root {
  --ink:#3c2e2a;
  --paper:#f6f1e6;
  --nav-horizontal-margin: 2rem; /* Define the horizontal margin */
}

  .navCluster {
    --tag-w: 160px;
    --tag-h: 68px;
    --gap: 14px;

    position: absolute;
    top: 60px;        /* pushes it down a bit so it visually lines up with the sign */
    right: 90px;      /* pulls it in from the edge like your mock */

    display: grid;
    grid-template-columns: repeat(3, var(--tag-w));
    grid-auto-rows: var(--tag-h);
    gap: var(--gap);

    align-items: start;
    justify-items: start;
    pointer-events: auto; /* Enable clicks */
    z-index: 100;
  }

  .navTag {
    position: relative;
    width: var(--tag-w);
    height: var(--tag-h);

    display: inline-block;
    text-decoration: none;

    filter: drop-shadow(0 6px 10px rgba(0,0,0,0.18));
    transform: translateY(0);
    transition: transform 160ms ease, filter 160ms ease;
  }

  .navTag__img {
    width: 100%;
    height: 100%;
    display: block;
    user-select: none;
    pointer-events: none;
  }

  .navTag__label {
    position: absolute;
    inset: 0;

    display: grid;
    place-items: center;

    font-family: Georgia, serif;
    font-size: 20px;
    line-height: 1;
    color: #3a2a1a;
    letter-spacing: 0.2px;

    text-shadow: 0 1px 0 rgba(255,255,255,0.35);
  }

  .navTag:hover {
    transform: translateY(-1px);
    filter: drop-shadow(0 9px 14px rgba(0,0,0,0.22));
  }

  .navTag:active {
    transform: translateY(0px);
    filter: drop-shadow(0 5px 8px rgba(0,0,0,0.16));
  }

  .navTag:focus-visible {
    outline: 2px solid rgba(58,42,26,0.55);
    outline-offset: 4px;
    border-radius: 14px;
  }

  /* Optional: make the second row align nicer (Contact + Blog) */
  .navCluster > .navTag:nth-child(4) { grid-column: 1; }
  .navCluster > .navTag:nth-child(5) { grid-column: 2; }

.bella {
  position: absolute;
  left: 19.53vw;
  top: 70.27vh;
  width: 14.06vw;
  height: auto;
  transform: translate(-50%, -50%);
  pointer-events: none;
  z-index: 11;
  filter: drop-shadow(0px 10px 15px rgba(0,0,0,0.5)) saturate(1.06) contrast(1.04);
}

.heroStage {
  /* --- TUNING VARS (edit these) --- */
  --haze-y: 46%;            /* where the horizon band starts */
  --haze-h: 18%;            /* height of haze band */
  --haze-strength: 0.38;    /* opacity of atmospheric haze */
  --haze-warmth: 1;         /* 0 = cooler, 1 = warmer */

  --store-shadow-x: 50%;    /* center under store */
  --store-shadow-y: 72%;    /* vertical position of shadow */
  --store-shadow-w: 560px;  /* width of shadow ellipse */
  --store-shadow-h: 90px;   /* height of shadow ellipse */
  --store-shadow-opacity: 0.22;

  --fg-pop-y: 74%;          /* center of foreground pop */
  --fg-pop-strength: 0.22;  /* opacity of pop overlay */

  /* Optional “global” micro-vignette to focus center */
  --vignette-strength: 0.10;
}

/* =========================================
   A) BACKGROUND: Atmospheric haze band
========================================= */
.atmoHaze{
  position: absolute;
  left: 0;
  right: 0;
  top: var(--haze-y);
  height: var(--haze-h);
  pointer-events: none;
  z-index: 30;

  background:
    radial-gradient(120% 120% at 50% 40%,
      rgba(255, 250, 240, calc(var(--haze-strength) * 0.55)) 0%,
      rgba(255, 250, 240, calc(var(--haze-strength) * 0.35)) 35%,
      rgba(255, 250, 240, 0) 70%),
    linear-gradient(to bottom,
      rgba(255, 255, 255, calc(var(--haze-strength) * 0.15)) 0%,
      rgba(255, 248, 235, calc(var(--haze-strength) * 0.60)) 35%,
      rgba(255, 248, 235, calc(var(--haze-strength) * 0.35)) 65%,
      rgba(255, 255, 255, 0) 100%);

  filter: blur(6px);
  mix-blend-mode: screen;
  opacity: 1;
}

@supports (filter: saturate(1)){
  .atmoHaze{
    filter: blur(6px) saturate(calc(1.0 + (var(--haze-warmth) * 0.05)));
  }
}

/* =========================================
   B) MIDGROUND: Soft ground shadow under store
========================================= */
.storeShadow{
  position: absolute;
  left: 50%;
  top: var(--store-shadow-y);
  transform: translateX(-50%);
  width: var(--store-shadow-w);
  height: var(--store-shadow-h);
  pointer-events: none;
  z-index: 40;

  background: radial-gradient(closest-side,
    rgba(0,0,0,var(--store-shadow-opacity)) 0%,
    rgba(0,0,0,calc(var(--store-shadow-opacity) * 0.55)) 35%,
    rgba(0,0,0,0) 70%);

  filter: blur(10px);
  mix-blend-mode: multiply;
  margin-left: 0px;
}

/* =========================================
   C) FOREGROUND: Subtle “pop” (lower center)
========================================= */
.foregroundPop{
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 50;

  background:
    radial-gradient(55% 45% at 50% var(--fg-pop-y),
      rgba(255, 255, 255, 0) 0%,
      rgba(255, 255, 255, 0) 45%,
      rgba(0,0,0, var(--fg-pop-strength)) 100%),
    radial-gradient(60% 55% at 50% var(--fg-pop-y),
      rgba(255, 255, 255, calc(var(--fg-pop-strength) * 0.22)) 0%,
      rgba(255, 255, 255, calc(var(--fg-pop-strength) * 0.08)) 40%,
      rgba(255, 255, 255, 0) 70%),
    radial-gradient(120% 90% at 50% 55%,
      rgba(0,0,0, var(--vignette-strength)) 0%,
      rgba(0,0,0, 0) 55%);

  mix-blend-mode: multiply;
  opacity: 1;
}

/* OPTIONAL: Water tower push back */
.waterTower{
  filter: saturate(0.75) contrast(0.85) blur(0.3px);
  opacity: 0.78;
}
</style>