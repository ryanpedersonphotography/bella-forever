---
import NavButton from "./NavButton.svelte";
const THEMES = {
  summer: {
    bg: "/sd.png",
    cloud: "/cloudl3.png",
    watertower: "/bobber3b.png",
    treeline: "/treeline6.png",
    store: "/bella-store-transparent.png",
    storeBase: "/store-base.png",
    bella: "/bella-pose3.png",
    grass: "/fg5.png"
  }
};
const theme = THEMES.summer;

// Data for Navigation Buttons
const navButtons = [
  { label: 'Home',    href: '/',         scene: 'home',    image: '/button1.png', variant: 'dark' },
  { label: 'About',   href: '/about',    scene: 'about',   image: '/button2.png', variant: 'dark' },
  { label: 'Shop',    href: '/shop',     scene: 'shop',    image: '/button3.png', variant: 'light' },
  { label: 'Gallery', href: '/gallery',  scene: 'gallery', image: '/button4.png', variant: 'dark' },
  { label: 'Contact', href: '/contact',  scene: 'contact', image: '/button5.png', variant: 'dark' },
  { label: 'Blog',    href: '/blog',     scene: 'blog',    image: '/blog3.png', variant: 'light' },
];

const leftNav = navButtons.slice(0, 3);
const rightNav = navButtons.slice(3);

// Data for store-base waves
const waves = [
  { top: 580, height: 5, depth: 0.17 }, { top: 590, height: 10, depth: 0.18 },
  { top: 600, height: 15, depth: 0.19 }, { top: 610, height: 25, depth: 0.20 },
  { top: 625, height: 35, depth: 0.21 }, { top: 640, height: 45, depth: 0.22 },
  { top: 660, height: 55, depth: 0.23 }, { top: 685, height: 65, depth: 0.24 },
  { top: 715, height: 75, depth: 0.25 },
];

const SCENE_COUNT = 6;
import { aboutSections } from "../scripts/stage-config";
---

<div class="viewport">
  <!-- STATIONARY BACKGROUND -->
  <div class="background">
    <img class="bg-image" src={theme.bg} alt="Watercolor Sky Background" />
  </div>

  <div id="camera">
    <!-- MOVING WORLD (scenes only) -->
    <div id="world" class="world" style={`height:${SCENE_COUNT * 100}vh`}>
      <!-- ============================================= -->
      <!-- SCENE 1: HOME                                 -->
      <!-- ============================================= -->
      <section id="home" class="scene">
        <div class="hero-stage__inner">
          <!-- Background image removed from here -->
          
          <img class="cloud hero-layer" src={theme.cloud} alt="Cloud" style="left: 1400px; top: 200px; width: 300px; z-index: 0;" data-stage-anim />
          <img class="waterTower hero-layer" src={theme.watertower} alt="Watertower" style="left: 1600px; top: 400px; width: 260px; z-index: 0;" data-stage-anim />
          <div class="treesFar hero-layer" style={`left: 960px; top: 500px; width: 4000px; height: 150px; background-image: url('${theme.treeline}'); background-repeat: repeat-x; background-position: bottom center; background-size: auto 100%;`} data-stage-anim></div>
          {waves.map((wave, i) => (
            <div class="store-base-wave hero-layer" style={`left: 960px; top: ${wave.top}px; width: 4000px; height: ${wave.height}px; background-image: url('${theme.storeBase}'); background-repeat: repeat-x; background-position: top center; background-size: auto 100%; opacity: ${0.2 + (i * 0.1)}; filter: drop-shadow(0px 2px 5px rgba(0,0,0,0.2));`} data-stage-anim></div>
          ))}
          <img class="shop hero-layer" src={theme.store} alt="Bella's Storefront" style="left: 960px; top: 585px; width: 600px; filter: drop-shadow(0px 10px 15px rgba(0,0,0,0.5));" data-stage-anim />
          <div class="grass hero-layer" style={`left: 960px; top: 870px; width: 8000px; height: 360px; background-image: url('${theme.grass}'); background-repeat: no-repeat; background-position: bottom center; background-size: auto 100%;`} data-stage-anim></div>
        </div>
      </section>

      <!-- ============================================= -->
      <!-- SCENE 2: ABOUT                                -->
      <!-- ============================================= -->
      <section id="about" class="scene">
          <!-- Horizontal sections -->
          <div id="story" class="aboutSection" data-stage-anim>
            <div class="about-content" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: #3c2e2a; z-index: 10;">
                <h1 style="font-family: 'Palatino Linotype', Palatino, serif; font-size: 64px;">Our Story</h1>
                <p style="font-family: 'Nunito', sans-serif; font-size: 24px; max-width: 600px; margin-top: 1rem;">A tiny fairytale boutique where little-daydream dresses come to life. Step into our watercolor world.</p>
            </div>
          </div>
          <div id="location" class="aboutSection" style="background-color: #fdf6e3;" data-stage-anim>
            <div class="about-content" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: #3c2e2a; z-index: 10;">
                <h1 style="font-family: 'Palatino Linotype', Palatino, serif; font-size: 64px;">Location</h1>
            </div>
          </div>
          <div id="team" class="aboutSection" style="background-color: #e3f6f6;" data-stage-anim>
            <div class="about-content" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: #3c2e2a; z-index: 10;">
                <h1 style="font-family: 'Palatino Linotype', Palatino, serif; font-size: 64px;">Team</h1>
            </div>
          </div>
          <div id="faq" class="aboutSection" style="background-color: #f6e3fd;" data-stage-anim>
            <div class="about-content" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: #3c2e2a; z-index: 10;">
                <h1 style="font-family: 'Palatino Linotype', Palatino, serif; font-size: 64px;">FAQ</h1>
            </div>
          </div>
      </section>

      <!-- ============================================= -->
      <!-- SCENE 3: SHOP (Placeholder)                   -->
      <!-- ============================================= -->
      <section id="shop" class="scene">
        <div style="display: grid; place-items: center; height: 100%; color: #3c2e2a;" data-stage-anim>
          <h1>Shop (Placeholder)</h1>
        </div>
      </section>

      <!-- ============================================= -->
      <!-- SCENE 4: GALLERY (Placeholder)                -->
      <!-- ============================================= -->
      <section id="gallery" class="scene">
         <div style="display: grid; place-items: center; height: 100%; color: #3c2e2a;" data-stage-anim>
          <h1>Gallery (Placeholder)</h1>
        </div>
      </section>

      <!-- ============================================= -->
      <!-- SCENE 5: CONTACT (Placeholder)                -->
      <!-- ============================================= -->
      <section id="contact" class="scene">
         <div style="display: grid; place-items: center; height: 100%; color: #3c2e2a;" data-stage-anim>
          <h1>Contact (Placeholder)</h1>
        </div>
      </section>

      <!-- ============================================= -->
      <!-- SCENE 6: BLOG (Placeholder)                   -->
      <!-- ============================================= -->
      <section id="blog" class="scene">
         <div style="display: grid; place-items: center; height: 100%; color: #3c2e2a;" data-stage-anim>
          <h1>Blog (Placeholder)</h1>
        </div>
      </section>
    </div>
  </div>

  <!-- PERSISTENT OVERLAY (does NOT move) -->
  <div class="overlay" style="--nav-horizontal-margin: 2rem;">
    <img class="hanging-sign" src="/bellassignroses.png" alt="Bella's Dresser sign" />
    
    <nav class="nav-split left">
      {leftNav.map(button => (
        <NavButton
          label={button.label}
          href={button.href}
          variant={button.variant}
          backgroundImage={button.image}
        />
      ))}
    </nav>

    <nav class="nav-split right">
      {rightNav.map(button => (
        <NavButton
          label={button.label}
          href={button.href}
          variant={button.variant}
          backgroundImage={button.image}
        />
      ))}
    </nav>

    <img class="bella" src={theme.bella} alt="Bella" />
    
    <!-- Side Navigation for 'About' sections -->
    <aside class="sideNav" aria-label="About sections">
      {aboutSections.map(section => (
        <a href={`/about#${section}`}>{section.charAt(0).toUpperCase() + section.slice(1)}</a>
      ))}
    </aside>
  </div>

  <!-- OPTIONAL FOREGROUND OVERLAY (does NOT move) -->
  <div class="foreground">
    <!-- <img src="/img/foreground-grass.png" alt="" /> -->
  </div>
<style>
/* General Scene Styles */
.viewport { 
  width: 100vw; 
  height: 100vh; 
  overflow: hidden; 
  position: fixed; 
  top: 0;
  left: 0;
}
.background {
  position: absolute;
  inset: 0;
  z-index: 0; /* Behind the world */
}

.bg-image {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

#camera {
  position: absolute;
  inset: 0;
  transform-origin: center center;
  will-change: transform;
}

.world { 
  position: absolute;
  inset: 0;
  width: 100vw; 
  will-change: transform;
  z-index: 1;
}
.scene { 
  width: 100vw; 
  height: 100vh; 
  position: relative;
  overflow: hidden;
  background-color: transparent; /* Changed to transparent */
}
.hero-stage__inner {
  position: absolute;
  top: 0;
  left: 0;
  width: 1920px;
  height: 1080px;
  transform-origin: top left;
  /* GSAP will handle scaling in the router now if needed, but for now we assume fixed size */
}
.hero-layer {
  position: absolute;
  will-change: transform;
  user-select: none;
  pointer-events: none;
  transform: translate(-50%, -50%); /* Center anchor default */
}

/* stays put while world pans */
.overlay {
  position: absolute;
  inset: 0;
  z-index: 10;
  pointer-events: none; /* allow world clicks unless you need them */
}

#about.scene{
  display:flex;        /* horizontal sections */
  width: 400vw;        /* 4 sections */
  height:100vh;
}

#about .aboutSection{
  width:100vw;
  height:100vh;
  flex: 0 0 100vw;
}

.foreground {
  position: absolute;
  inset: auto 0 0 0;
  height: 34vh;        /* tune */
  z-index: 20;
  pointer-events: none;
}

.foreground img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.sideNav{ position:absolute; left:28px; top:170px; z-index:120; display:flex; flex-direction:column; gap:14px;
          opacity:0; transform:translateY(-4px); transition:opacity .2s ease, transform .2s ease; pointer-events: none; }
.sideNav.is-active{ opacity:1; transform:translateY(0); pointer-events: auto; }
.sideNav a{ text-decoration:none; font-family:"Nunito",system-ui,sans-serif; font-weight:800; color:#3c2e2a;
           background:rgba(255,255,255,.55); border:1px solid rgba(60,46,42,.18); border-radius:12px;
           padding:10px 14px; backdrop-filter:blur(6px); }

/* --- Button Styles --- */
:root {
  --ink:#3c2e2a;
  --paper:#f6f1e6;
  --nav-horizontal-margin: 2rem; /* Define the horizontal margin */
}

  .nav-split {
    position: fixed;
    top: 45px; /* Aligns with roughly where chain ends/sign starts given sign top: -70px */
    display: flex;
    gap: 1.5rem;
    z-index: 100;
    pointer-events: auto;
    transform: scale(0.6); /* Shrink by 40% */
  }

  .nav-split.left {
    right: 50%;
    margin-right: 360px; /* Half sign width (720/2) */
    justify-content: flex-end;
    transform-origin: right center;
  }

  .nav-split.right {
    left: 50%;
    margin-left: 360px; /* Half sign width */
    justify-content: flex-start;
    transform-origin: left center;
  }

.bella {
  position: absolute;
  left: 19.53vw;
  top: 70.27vh;
  width: 14.06vw;
  height: auto;
  transform: translate(-50%, -50%);
  pointer-events: none;
  z-index: 11;
  filter: drop-shadow(0px 10px 15px rgba(0,0,0,0.5));
}

.hanging-sign{
  position: fixed;
  top: -70px;                 /* pulls the chain “attachment” above the screen */
  left: 50%;
  transform: translateX(-50%);
  width: 720px;              /* set your desktop size */
  height: auto;
  z-index: 9999;
  pointer-events: none;
  filter: drop-shadow(0 10px 14px rgba(0,0,0,0.18))
          drop-shadow(0 2px 4px rgba(0,0,0,0.12));
  transform-origin: 50% 0%;
}

/* optional: tiny sway */
.hanging-sign{
  animation: signSway 8s ease-in-out infinite;
}
 @keyframes signSway{
  0%,100%{ transform: translateX(-50%) rotate(-0.25deg); }
  50%    { transform: translateX(-50%) rotate(0.25deg); }
}
</style>